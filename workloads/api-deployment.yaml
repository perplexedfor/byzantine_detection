apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-baseline
  labels:
    app: api-baseline
spec:
  replicas: 2
  selector:
    matchLabels:
      app: api-baseline
  template:
    metadata:
      labels:
        app: api-baseline
    spec:
      containers:
      - name: api
        image: python:3.9-slim
        command:
        - python
        - -c
        - |
          import http.server
          import socketserver
          import time
          import random
          
          class Handler(http.server.SimpleHTTPRequestHandler):
              def do_GET(self):
                  # Simulate some processing time
                  time.sleep(random.uniform(0.01, 0.1))
                  self.send_response(200)
                  self.send_header('Content-type', 'text/plain')
                  self.end_headers()
                  self.wfile.write(b'API Response OK\n')

          with socketserver.TCPServer(("", 8080), Handler) as httpd:
              print("serving at port", 8080)
              httpd.serve_forever()
        ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: api-baseline-svc
spec:
  selector:
    app: api-baseline
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
  type: ClusterIP
